# Model 1 Parameter Logistik (1PL)

## Konsep Dasar Model 1PL

**Model 1 Parameter Logistik (1PL)** adalah model IRT paling sederhana. Disebut "1 parameter" karena hanya satu parameter item yang diestimasi, yaitu **parameter kesulitan (*b*)**.

Model ini mengasumsikan bahwa:

- Semua item memiliki **daya beda yang sama** (*a* konstan = 1.0)
- Tidak ada efek tebakan (*c* = 0)
- Hanya posisi kurva pada skala θ yang berbeda antar item

## Formula Model 1PL

$$P(X_{ij} = 1 \mid \theta_j, b_i) = \frac{e^{(\theta_j - b_i)}}{1 + e^{(\theta_j - b_i)}}$$

Yang equivalen dengan:

$$P(X_{ij} = 1 \mid \theta_j, b_i) = \frac{1}{1 + e^{-(\theta_j - b_i)}}$$

Di mana:

- $\theta_j$ = kemampuan peserta $j$ (dalam logit)
- $b_i$ = parameter kesulitan item $i$ (dalam logit)
- $P(\cdot)$ = probabilitas menjawab benar

::: {.callout-note title="Hubungan 1PL dengan Rasch Model"}
Model 1PL dan Rasch Model secara matematis **identik** ketika konstanta *D* = 1. Perbedaan filosofis ada pada pendekatan:

| | 1PL (dalam IRT) | Rasch Model |
|--|---|---|
| Orientasi | Fit model ke data | Data harus fit ke model |
| Estimasi | MML (mirt) | CML (eRm) atau JML (TAM) |
| Perlakuan misfit | Item direvisi jika perlu | Item *harus* fit ke model |
:::

## ICC Model 1PL

```{r}
#| label: fig-icc-1pl
#| fig-cap: "Item Characteristic Curves — Model 1PL"

library(ggplot2)
library(dplyr)

theta <- seq(-4, 4, by = 0.05)

icc_1pl <- function(theta, b) {
  1 / (1 + exp(-(theta - b)))
}

b_values <- c(-2.0, -1.0, 0.0, 1.0, 2.0)
labels   <- paste0("b = ", ifelse(b_values > 0, paste0("+", b_values), b_values))

df_icc <- data.frame(
  theta = rep(theta, length(b_values)),
  prob  = unlist(lapply(b_values, function(b) icc_1pl(theta, b))),
  item  = factor(rep(labels, each = length(theta)), levels = labels)
)

ggplot(df_icc, aes(x = theta, y = prob, color = item)) +
  geom_line(linewidth = 1.2) +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "gray60", linewidth = 0.8) +
  geom_vline(xintercept = b_values, linetype = "dotted", 
             color = scales::hue_pal()(5), alpha = 0.6) +
  scale_color_brewer(palette = "RdYlBu", direction = -1) +
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  annotate("text", x = -3.7, y = 0.53, label = "P = 0.50", 
           color = "gray40", size = 3.5) +
  labs(
    title    = "Item Characteristic Curves — Model 1PL",
    subtitle = "Semua kurva memiliki kemiringan (slope) yang sama\nKurva bergeser kanan = item lebih sulit",
    x        = "Kemampuan Peserta (θ)",
    y        = "Probabilitas Menjawab Benar P(θ)",
    color    = "Parameter Kesulitan"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "right",
        plot.subtitle = element_text(color = "gray40", size = 10))
```

### Membaca ICC Model 1PL

```{r}
#| label: fig-icc-annotasi
#| fig-cap: "Anotasi Pembacaan ICC — Model 1PL"

# ICC dengan anotasi detail untuk satu item
b_item <- 0.5

df_single <- data.frame(
  theta = theta,
  prob  = icc_1pl(theta, b_item)
)

ggplot(df_single, aes(x = theta, y = prob)) +
  geom_ribbon(aes(ymin = 0, ymax = prob),
              fill = "#3498db", alpha = 0.15) +
  geom_line(linewidth = 1.5, color = "#3498db") +
  # Titik b (P = 0.5)
  geom_point(x = b_item, y = 0.5, size = 5, color = "#e74c3c") +
  geom_segment(x = b_item, xend = b_item, y = 0, yend = 0.5,
               linetype = "dashed", color = "#e74c3c", linewidth = 0.9) +
  geom_segment(x = -4, xend = b_item, y = 0.5, yend = 0.5,
               linetype = "dashed", color = "#e74c3c", linewidth = 0.9) +
  # Anotasi
  annotate("text", x = b_item + 0.3, y = 0.45,
           label = "b = 0.5\n(P = 50%)", color = "#e74c3c",
           size = 4, fontface = "bold", hjust = 0) +
  annotate("text", x = -3, y = 0.9,
           label = "Peserta dengan\nθ >> b\n→ sangat mudah", 
           color = "#27ae60", size = 3.5) +
  annotate("text", x = 2.5, y = 0.1,
           label = "Peserta dengan\nθ << b\n→ sangat sulit",
           color = "#e74c3c", size = 3.5) +
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  labs(
    title    = "Membaca ICC: Item dengan b = +0.5",
    subtitle = "Titik merah = parameter kesulitan b (di sini P(benar) = 50%)",
    x = "Kemampuan (θ)", y = "P(benar | θ)"
  ) +
  theme_minimal(base_size = 12)
```

## Item Information Function (IIF) — Model 1PL

Untuk model 1PL, IIF memiliki bentuk:

$$I_i(\theta) = P_i(\theta) \cdot [1 - P_i(\theta)]$$

Informasi maksimum terjadi ketika $\theta = b$, yaitu:

$$I_i^{max} = 0.5 \times 0.5 = 0.25$$

::: {.callout-important title="Implikasi Informasi Maksimum"}
Karena semua item 1PL memiliki *a* = 1, **semua item memberikan informasi maksimum yang sama** (0.25) — hanya berbeda *di mana* informasi tersebut paling tinggi (yaitu pada θ = b masing-masing item).
:::

```{r}
#| label: fig-iif-1pl
#| fig-cap: "Item Information Function — Model 1PL"

iif_1pl <- function(theta, b) {
  p <- icc_1pl(theta, b)
  p * (1 - p)
}

df_iif <- data.frame(
  theta = rep(theta, length(b_values)),
  info  = unlist(lapply(b_values, function(b) iif_1pl(theta, b))),
  item  = factor(rep(labels, each = length(theta)), levels = labels)
)

ggplot(df_iif, aes(x = theta, y = info, color = item)) +
  geom_line(linewidth = 1.2) +
  geom_hline(yintercept = 0.25, linetype = "dashed", 
             color = "gray50", linewidth = 0.8) +
  annotate("text", x = 3.5, y = 0.26,
           label = "I_max = 0.25", color = "gray40", size = 3.5) +
  scale_color_brewer(palette = "RdYlBu", direction = -1) +
  labs(
    title    = "Item Information Function — Model 1PL",
    subtitle = "Semua item memiliki informasi maksimum yang sama (0.25)\nhanya berbeda posisi puncaknya",
    x = "Kemampuan (θ)", y = "Informasi Item I(θ)",
    color = "Parameter b"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "right")
```

## Estimasi Model 1PL di R

### Menggunakan `mirt`

```{r}
#| label: estimasi-1pl-mirt
#| cache: true

library(mirt)

# ======================================================
# SIMULASI DATA 1PL
# ======================================================
set.seed(2025)

n_peserta <- 400
n_item    <- 20

# True parameters (a = 1 untuk semua item, tidak ada c)
b_true    <- seq(-2.5, 2.5, length.out = n_item)
theta_true <- rnorm(n_peserta, mean = 0, sd = 1)

# Generate respon berdasarkan model 1PL
prob_1pl <- outer(theta_true, b_true, function(t, b) 
  1 / (1 + exp(-(t - b))))

data_1pl <- matrix(
  rbinom(n_peserta * n_item, 1, prob_1pl),
  nrow = n_peserta,
  dimnames = list(
    paste0("P", 1:n_peserta),
    paste0("Item", sprintf("%02d", 1:n_item))
  )
)

cat("=== DATA SIMULASI 1PL ===\n")
cat("Dimensi       :", dim(data_1pl), "\n")
cat("Proporsi benar:", round(mean(data_1pl), 3), "\n\n")

# ======================================================
# ESTIMASI DENGAN MIRT (itemtype = "Rasch")
# ======================================================
model_1pl <- mirt(
  data     = data_1pl,
  model    = 1,
  itemtype = "Rasch",   # 1PL / Rasch
  SE       = TRUE,
  verbose  = FALSE
)

summary(model_1pl)
```

```{r}
#| label: tbl-param-1pl
#| tbl-cap: "Tabel Parameter Item — Model 1PL (semua item)"

library(knitr)
library(kableExtra)

# Ekstrak parameter dalam skala IRT
params_raw <- coef(model_1pl, IRTpars = TRUE, simplify = TRUE)$items

# Ekstrak SE dengan cara yang benar untuk mirt
coef_full  <- coef(model_1pl, SE = TRUE, simplify = FALSE)
se_b <- tryCatch({
  # Ambil SE dari parameter d (intercept) lalu konversi ke skala b
  sapply(coef_full[seq_len(n_item)], function(x) x["d", "SE"])
}, error = function(e) rep(NA_real_, n_item))

params_1pl <- data.frame(
  Item       = paste0("Item", sprintf("%02d", 1:n_item)),
  b_estimasi = round(params_raw[, "b"], 3),
  b_true     = round(b_true, 3),
  SE_b       = round(abs(se_b), 3),
  Kategori   = cut(params_raw[, "b"],
                   breaks = c(-Inf, -1.5, -0.5, 0.5, 1.5, Inf),
                   labels = c("Sangat Mudah", "Mudah", "Sedang", "Sulit", "Sangat Sulit"))
)

# Buat tabel dasar
tbl_1pl <- kable(params_1pl,
      col.names = c("Item", "b Estimasi", "b True", "SE(b)", "Kategori"),
      align     = "c") |>
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)

# Tambah warna baris hanya jika ada baris yang cocok
idx_sulit <- which(as.character(params_1pl$Kategori) == "Sangat Sulit")
idx_mudah <- which(as.character(params_1pl$Kategori) == "Sangat Mudah")
if (length(idx_sulit) > 0) tbl_1pl <- row_spec(tbl_1pl, idx_sulit, background = "#fdecea")
if (length(idx_mudah) > 0) tbl_1pl <- row_spec(tbl_1pl, idx_mudah, background = "#e8f5e9")
tbl_1pl
```

### Menggunakan `eRm` (CML — Conditional Maximum Likelihood)

```{r}
#| label: estimasi-1pl-erm

library(eRm)

# eRm menggunakan CML — tidak memerlukan estimasi θ
model_erm <- RM(data_1pl)

cat("=== ESTIMASI eRm (CML) ===\n")
cat("Jumlah item diestimasi:", length(model_erm$betapar), "\n\n")

# Parameter b dari eRm (dalam bentuk -beta)
b_erm <- -model_erm$betapar
cat("Parameter b (5 item pertama):\n")
print(round(b_erm[1:5], 3))
```

```{r}
#| label: fig-recovery-1pl
#| fig-cap: "Parameter Recovery — Estimasi vs True Value (Model 1PL)"

b_mirt <- params_raw[, "b"]

df_rec <- data.frame(
  b_true = b_true,
  b_mirt = b_mirt,
  b_erm  = b_erm
)

library(tidyr)
df_long <- pivot_longer(df_rec, cols = c(b_mirt, b_erm),
                         names_to = "Metode", values_to = "b_est")
df_long$Metode <- ifelse(df_long$Metode == "b_mirt",
                          "MML (mirt)", "CML (eRm)")

ggplot(df_long, aes(x = b_true, y = b_est, color = Metode, shape = Metode)) +
  geom_point(size = 3, alpha = 0.8) +
  geom_abline(slope = 1, intercept = 0,
              linetype = "dashed", color = "gray50", linewidth = 1) +
  scale_color_manual(values = c("#3498db", "#e74c3c")) +
  labs(
    title    = "Parameter Recovery — Model 1PL",
    subtitle = "Garis putus-putus = garis sempurna (estimasi = true value)",
    x = "b True", y = "b Estimasi",
    color = "Metode Estimasi", shape = "Metode Estimasi"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```


# Batas garis referensi
batas_y <- -log10(0.05)   # ≈ 1.301

ggplot(fit_df, aes(x = reorder(Item, neglog_p), y = neglog_p, fill = Status)) +
  geom_col(width = 0.65) +
  geom_hline(yintercept = batas_y,
             linetype = "dashed", color = "#c0392b", linewidth = 0.9) +
  coord_flip() +
  scale_fill_manual(values = c("Fit" = "#27ae60", "Misfit" = "#e74c3c")) +
  # Anotasi pada sumbu y (bukan x kategoris) — pakai geom_text pada titik tetap
  geom_label(aes(x = 1, y = batas_y, label = "p = .05"),
             inherit.aes = FALSE,
             fill = "white", color = "#c0392b", size = 3.2,
             hjust = -0.1, vjust = 0.5) +
  labs(
    title    = "Item Fit S-X\u00b2 \u2014 Model 1PL",
    subtitle = paste0("Nilai -log\u2081\u2080(p) lebih tinggi = lebih bermasalah\n",
                      "Garis merah = batas signifikan (p < .05)"),
    x = NULL, y = "-log\u2081\u2080(p-value)", fill = "Status"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

## Estimasi Kemampuan Peserta (θ)

```{r}
#| label: fig-theta-1pl
#| fig-cap: "Distribusi Estimasi Kemampuan Peserta — Model 1PL"

theta_est <- fscores(model_1pl, method = "EAP")[, 1]

df_theta <- data.frame(
  theta_true = theta_true,
  theta_est  = theta_est
)

cor_theta <- cor(theta_true, theta_est)

p1 <- ggplot(df_theta, aes(x = theta_est)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30,
                 fill = "#3498db", alpha = 0.7, color = "white") +
  geom_density(linewidth = 1.2, color = "#1a5276") +
  geom_vline(xintercept = mean(theta_est), 
             linetype = "dashed", color = "#e74c3c", linewidth = 1) +
  labs(title = "Distribusi Estimasi θ (EAP)",
       subtitle = sprintf("Mean = %.3f, SD = %.3f",
                          mean(theta_est), sd(theta_est)),
       x = "θ Estimasi", y = "Densitas") +
  theme_minimal(base_size = 12)

p2 <- ggplot(df_theta, aes(x = theta_true, y = theta_est)) +
  geom_point(alpha = 0.4, size = 1.5, color = "#3498db") +
  geom_smooth(method = "lm", color = "#e74c3c", linewidth = 1, se = TRUE) +
  labs(title = "θ True vs θ Estimasi",
       subtitle = sprintf("r = %.3f", cor_theta),
       x = "θ True", y = "θ Estimasi (EAP)") +
  theme_minimal(base_size = 12)

library(patchwork)
p1 + p2
```

## Kapan Menggunakan Model 1PL?

```{r}
#| echo: false
#| tbl-cap: "Panduan Pemilihan Model: Kapan Gunakan 1PL?"

library(knitr)

df_kapan <- data.frame(
  Kondisi = c(
    "Ukuran sampel kecil (n < 200)",
    "Item dikembangkan dari domain yang sama",
    "Fokus pada lokasi item di skala (b)",
    "Tujuan construct mapping",
    "Memerlukan pengukuran setara (specific objectivity)",
    "Item dari domain berbeda atau heterogen",
    "Sampel besar dan perlu diskriminasi item",
    "Item pilihan ganda (banyak alternatif jawaban)"
  ),
  Rekomendasi = c(
    "✅ Gunakan 1PL / Rasch",
    "✅ Gunakan 1PL / Rasch",
    "✅ Gunakan 1PL / Rasch",
    "✅ Gunakan 1PL / Rasch",
    "✅ Gunakan 1PL / Rasch",
    "⚠ Pertimbangkan 2PL",
    "⚠ Pertimbangkan 2PL",
    "⚠ Pertimbangkan 3PL"
  )
)

kable(df_kapan, col.names = c("Kondisi", "Rekomendasi"), align = "l")
```

## Latihan Mandiri {.unnumbered}

1. Dengan menggunakan data `data_1pl` yang telah dibuat, bandingkan estimasi model 1PL dari `mirt` dan `eRm`. Seberapa besar korelasi antara kedua set parameter *b*?

2. Modifikasi kode simulasi untuk membuat dataset dengan 500 peserta dan 25 item. Amati bagaimana akurasi parameter recovery berubah dengan ukuran sampel yang lebih besar.

3. Buat ICC untuk item dengan *b* = −2.5 dan *b* = +2.5. Interpretasikan: apa artinya bagi peserta dengan kemampuan rata-rata (θ = 0)?

